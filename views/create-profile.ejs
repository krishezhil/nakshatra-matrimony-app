<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Create Profile - ‡Æï‡Æ®‡Øç‡Æ§ ‡Æï‡Øã‡Æü‡Øç‡Æü‡ÆÆ‡Øç ‡Æö‡Øá‡Æµ‡Ææ ‡Æö‡Æô‡Øç‡Æï‡ÆÆ‡Øç</title>
    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/vendor/animate.min.css" rel="stylesheet">
    <link href="/css/vendor/aos.css" rel="stylesheet">
    <link href="/css/vendor/select2.min.css" rel="stylesheet">
    <link href="/css/brand.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        
        .profile-container {
            min-height: 100vh;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.8) 0%, rgba(220, 20, 60, 0.8) 50%, rgba(255, 99, 71, 0.8) 100%), 
                        url('/assets/background-image.jpg') center/cover no-repeat fixed;
            position: relative;
        }
        
        .profile-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(139, 0, 0, 0.1);
            z-index: 1;
        }
        
        .content-wrapper {
            position: relative;
            z-index: 2;
            padding-top: 120px;
            padding-bottom: 50px;
        }
        
        .page-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 3px solid rgba(255, 215, 0, 0.6);
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            color: white;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .page-title {
            font-size: 2.8rem;
            font-weight: bold;
            color: #800020;
            text-shadow: 2px 2px 4px rgba(255, 215, 0, 0.3);
            font-family: 'Noto Sans Tamil', 'Noto Sans', sans-serif;
            margin-bottom: 15px;
        }
        
        .page-subtitle {
            font-size: 1.3rem;
            color: #800020;
            text-shadow: 1px 1px 2px rgba(255, 215, 0, 0.3);
            margin-bottom: 0;
        }
        
        .form-container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 25px;
            padding: 50px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .form-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .form-section:hover {
            border-color: rgba(255, 215, 0, 0.5);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
        }
        
        .section-title {
            color: #800020;
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(255, 215, 0, 0.3);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            font-size: 1.2rem;
            color: #FFD700;
        }
        
        .form-label {
            color: #800020;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
            margin-bottom: 8px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
            display: inline-block;
        }
        
        .form-control, .form-select {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 12px 15px;
            color: #800020;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .form-control:focus, .form-select:focus {
            background: rgba(255, 255, 255, 1);
            border-color: #FFD700;
            box-shadow: 0 0 0 0.2rem rgba(255, 215, 0, 0.25);
            color: #800020;
        }
        
        /* Input group styling for gothram field */
        .input-group .form-select {
            border-top-right-radius: 0 !important;
            border-bottom-right-radius: 0 !important;
        }
        
        .input-group .btn {
            border-top-left-radius: 0 !important;
            border-bottom-left-radius: 0 !important;
            height: auto;
        }
        
        /* Custom styling for small plus button */
        .brand-btn-secondary.btn-sm {
            padding: 8px 12px !important;
            font-size: 0.9rem !important;
            min-height: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-submit {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #800020;
            border: 3px solid #FFD700;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.4);
            width: 100%;
            margin-top: 20px;
        }
        
        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(255, 215, 0, 0.6);
            background: linear-gradient(45deg, #FFFF00, #FFD700);
            color: #800020;
            border-color: #FFFF00;
        }
        
        /* Brand Buttons */
        .brand-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #800020;
            border: 3px solid #FFD700;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 25px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .brand-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(255, 215, 0, 0.6);
            background: linear-gradient(45deg, #FFFF00, #FFD700);
            color: #800020;
            border-color: #FFFF00;
            text-decoration: none;
        }
        
        .brand-btn-secondary {
            background: linear-gradient(45deg, #800020, #A0002A);
            color: #FFD700;
            border: 3px solid #800020;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 25px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(128, 0, 32, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .brand-btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(128, 0, 32, 0.6);
            background: linear-gradient(45deg, #A0002A, #800020);
            color: #FFFF00;
            border-color: #A0002A;
            text-decoration: none;
        }
        
        .floating-elements {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }
        
        .floating-symbol {
            position: absolute;
            color: rgba(255, 215, 0, 0.1);
            font-size: 3rem;
            animation: float 20s ease-in-out infinite;
        }
        
        .floating-symbol:nth-child(1) {
            top: 15%;
            left: 5%;
            animation-delay: 0s;
        }
        
        .floating-symbol:nth-child(2) {
            top: 75%;
            right: 10%;
            animation-delay: 7s;
        }
        
        .floating-symbol:nth-child(3) {
            bottom: 25%;
            left: 15%;
            animation-delay: 14s;
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
                opacity: 0.1;
            }
            50% {
                transform: translateY(-30px) rotate(180deg);
                opacity: 0.2;
            }
        }
        
        /* Custom Scrollbar */
        .form-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .form-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .form-container::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.5);
            border-radius: 10px;
        }
        
        .form-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 215, 0, 0.7);
        }
        
        @media (max-width: 768px) {
            .page-title {
                font-size: 2rem;
            }
            .form-container {
                padding: 25px 20px;
                max-height: 70vh;
            }
            .content-wrapper {
                padding-top: 100px;
            }
        }
    </style>
</head>
		<body class="d-flex flex-column min-vh-100" style="background: url('/assets/background-image.jpg') no-repeat center center fixed; background-size: cover;">
		    <!-- Floating Hindu Symbols -->
		    <div class="floating-symbols">
		        <div class="symbol" style="top: 60%; left: 5%;">ü™î</div>
		        <div class="symbol" style="top: 70%; left: 75%;">ü™î</div>
		    </div>

		    <!-- Background Overlay -->
		    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(128, 0, 32, 0.2) 100%); z-index: -1;"></div>

		<%- include('partials/navbar') %>
		
		<div class="content-wrapper">
		    <div class="form-container" data-aos="fade-up" data-aos-duration="1000">
		        <div class="page-title" data-aos="fade-down" data-aos-delay="200">
		            <i class="fas fa-user-plus me-3"></i>Create Profile
		        </div>
		        
		        <% if (typeof error !== 'undefined' && error) { %>
		            <div class="alert alert-danger" role="alert">
		                <i class="fas fa-exclamation-triangle me-2"></i><%= error %>
		            </div>
		        <% } %>
		        
		        <!-- Validation Errors Summary -->
		        <% if (typeof fieldErrors !== 'undefined' && fieldErrors && Object.keys(fieldErrors).length > 0) { %>
		            <div class="alert alert-danger" role="alert" id="validation-summary">
		                <div class="d-flex align-items-center mb-3">
		                    <i class="fas fa-exclamation-circle me-2"></i>
		                    <h6 class="mb-0 fw-bold">Please fix the following errors:</h6>
		                </div>
		                <ul class="mb-0 ps-3">
		                    <% Object.entries(fieldErrors).forEach(([field, message]) => { %>
		                        <li class="mb-1">
		                            <strong><%= field.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) %>:</strong> 
		                            <%= message %>
		                        </li>
		                    <% }) %>
		                </ul>
		                <div class="mt-3">
		                    <small class="text-muted">
		                        <i class="fas fa-info-circle me-1"></i>
		                        Fields with errors are highlighted in red below. Please correct them and try again.
		                    </small>
		                </div>
		                <!-- Debug info (remove in production) -->
		                <% if (typeof formData !== 'undefined' && Object.keys(formData).length > 0) { %>
		                    <div class="mt-2">
		                        <small class="text-info">
		                            <i class="fas fa-bug me-1"></i>
		                            DEBUG: Form data preserved (<%= Object.keys(formData).length %> fields)
		                        </small>
		                    </div>
		                <% } %>
		            </div>
		        <% } %>
		        
		        <form class="row g-4" method="POST" action="/profile/create">
		            
		            <!-- Basic Information Section -->
		            <div class="col-12 form-section" data-aos="fade-right" data-aos-delay="300">
		                <h5 class="section-title">
		                    <i class="fas fa-id-card me-2"></i>Basic Information
		                </h5>
		                <div class="row g-3">
		                    <div class="col-md-6">
		                        <label class="form-label">Serial No <span class="text-danger">*</span></label>
		                        <input type="text" id="serial_no" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.serial_no) ? 'is-invalid' : '' %>" 
		                               name="serial_no" value="<%= (typeof formData !== 'undefined' && formData?.serial_no) || '' %>" 
		                               required placeholder="Enter unique serial number">
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.serial_no) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.serial_no %></div>
		                        <% } %>
		                        <div class="form-text">Enter a unique serial number with letters, numbers, hyphens, or underscores (max 20 characters)</div>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Name</label>
		                        <input type="text" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.name) ? 'is-invalid' : '' %>" 
		                               name="name" value="<%= (typeof formData !== 'undefined' && formData?.name) || '' %>" required>
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.name) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.name %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-5">
		                        <label class="form-label">Gothram <span class="text-danger">*</span></label>
		                        <select class="form-select <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.gothram) ? 'is-invalid' : '' %>" 
		                                name="gothram" required
		                                data-saved-value='<%- JSON.stringify(((typeof formData !== 'undefined' && formData?.gothram) || '').toString()) %>'>
		                            <option value="" disabled <%= !(typeof formData !== 'undefined' && formData?.gothram) ? 'selected' : '' %>>Select Gothram (required)</option>
		                            <!-- Options loaded dynamically via gothram-dropdown.js -->
		                        </select>
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.gothram) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.gothram %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-1">
		                        <label class="form-label" style="visibility: hidden;">Add</label>
		                        <button type="button" class="btn brand-btn-secondary btn-sm w-100" data-bs-toggle="modal" data-bs-target="#addGothramModal" title="Add New Gothram" onclick="event.preventDefault(); event.stopPropagation();">
		                            <i class="fas fa-plus"></i>
		                        </button>
		                    </div>
		                </div>
		            </div>

		            <!-- Family Information Section -->
		            <div class="col-12 form-section" data-aos="fade-left" data-aos-delay="400">
		                <h5 class="section-title">
		                    <i class="fas fa-users me-2"></i>Family Information
		                </h5>
		                <div class="row g-3">
		                    <div class="col-md-6">
		                        <label class="form-label">Father Name <span class="text-danger">*</span></label>
		                        <input type="text" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.father_name) ? 'is-invalid' : '' %>" 
		                               name="father_name" value="<%= (typeof formData !== 'undefined' && formData?.father_name) || '' %>"
		                               required minlength="2" maxlength="100" placeholder="Enter father's full name (required)">
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.father_name) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.father_name %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Mother Name <span class="text-danger">*</span></label>
		                        <input type="text" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.mother_name) ? 'is-invalid' : '' %>" 
		                               name="mother_name" value="<%= (typeof formData !== 'undefined' && formData?.mother_name) || '' %>"
		                               required minlength="2" maxlength="100" placeholder="Enter mother's full name (required)">
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.mother_name) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.mother_name %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Siblings</label>
		                        <input type="text" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.siblings) ? 'is-invalid' : '' %>" 
		                               name="siblings" value="<%= (typeof formData !== 'undefined' && formData?.siblings) || '' %>">
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.siblings) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.siblings %></div>
		                        <% } %>
		                    </div>
		                </div>
		            </div>

		            <!-- Birth Details Section -->
		            <div class="col-12 form-section" data-aos="fade-right" data-aos-delay="500">
		                <h5 class="section-title">
		                    <i class="fas fa-calendar-alt me-2"></i>Birth Details
		                </h5>
		                <div class="row g-3">
		                    <div class="col-md-6">
		                        <label class="form-label">Birth Date <span class="text-danger">*</span></label>
		                        <input type="date" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.birth_date) ? 'is-invalid' : '' %>" 
		                               name="birth_date" value="<%= (typeof formData !== 'undefined' && formData?.birth_date) || '' %>"
		                               required min="1949-01-01" max="2006-12-31">
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.birth_date) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.birth_date %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Birth Time <span class="text-danger">*</span></label>
		                        <input type="time" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.birth_time) ? 'is-invalid' : '' %>" 
		                               name="birth_time" value="<%= (typeof formData !== 'undefined' && formData?.birth_time) || '' %>" required>
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.birth_time) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.birth_time %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Birth Place <span class="text-danger">*</span></label>
		                        <input type="text" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.birth_place) ? 'is-invalid' : '' %>" 
		                               name="birth_place" value="<%= (typeof formData !== 'undefined' && formData?.birth_place) || '' %>" required>
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.birth_place) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.birth_place %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Gender <span class="text-danger">*</span></label>
		                        <select class="form-select <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.gender) ? 'is-invalid' : '' %>" 
		                                name="gender" required>
		                            <option value="">Select Gender</option>
		                            <option value="Male" <%= (typeof formData === 'undefined' || formData?.gender === 'Male' || !formData?.gender) ? 'selected' : '' %>>Male</option>
		                            <option value="Female" <%= (typeof formData !== 'undefined' && formData?.gender === 'Female') ? 'selected' : '' %>>Female</option>
		                        </select>
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.gender) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.gender %></div>
		                        <% } %>
		                    </div>
		                </div>
		            </div>

		            <!-- Education & Career Section -->
		            <div class="col-12 form-section" data-aos="fade-left" data-aos-delay="600">
		                <h5 class="section-title">
		                    <i class="fas fa-graduation-cap me-2"></i>Education & Career
		                </h5>
		                <div class="row g-3">
		                    <div class="col-md-6">
		                        <label class="form-label">Qualification <span class="text-danger">*</span></label>
		                        <select class="form-select <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.qualification) ? 'is-invalid' : '' %>" 
		                                name="qualification" required>
		                            <option value="">Select Qualification</option>
		                            <option value="School" <%= (typeof formData !== 'undefined' && formData?.qualification === 'School') ? 'selected' : '' %>>School</option>
		                            <option value="Diploma" <%= (typeof formData !== 'undefined' && formData?.qualification === 'Diploma') ? 'selected' : '' %>>Diploma</option>
		                            <option value="UG" <%= (typeof formData !== 'undefined' && formData?.qualification === 'UG') ? 'selected' : '' %>>UG</option>
		                            <option value="PG" <%= (typeof formData !== 'undefined' && formData?.qualification === 'PG') ? 'selected' : '' %>>PG</option>
		                            <option value="PHD" <%= (typeof formData !== 'undefined' && formData?.qualification === 'PHD') ? 'selected' : '' %>>PHD</option>
		                            <option value="Doctor" <%= (typeof formData !== 'undefined' && formData?.qualification === 'Doctor') ? 'selected' : '' %>>Doctor</option>
		                        </select>
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.qualification) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.qualification %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Qualification Details</label>
		                        <input type="text" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.qualification_details) ? 'is-invalid' : '' %>" 
		                               name="qualification_details" value="<%= (typeof formData !== 'undefined' && formData?.qualification_details) || '' %>">
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.qualification_details) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.qualification_details %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Job Details</label>
		                        <input type="text" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.job_details) ? 'is-invalid' : '' %>" 
		                               name="job_details" value="<%= (typeof formData !== 'undefined' && formData?.job_details) || '' %>">
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.job_details) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.job_details %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Monthly Income</label>
		                        <input type="number" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.monthly_income) ? 'is-invalid' : '' %>" 
		                               name="monthly_income" value="<%= (typeof formData !== 'undefined' && formData?.monthly_income) || '' %>">
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.monthly_income) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.monthly_income %></div>
		                        <% } %>
		                    </div>
		                </div>
		            </div>

		            <!-- Contact & Location Section -->
		            <div class="col-12 form-section" data-aos="fade-right" data-aos-delay="700">
		                <h5 class="section-title">
		                    <i class="fas fa-map-marker-alt me-2"></i>Contact & Location
		                </h5>
		                <div class="row g-3">
		                    <div class="col-md-6">
		                        <label class="form-label">Address</label>
		                        <input type="text" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.address) ? 'is-invalid' : '' %>" 
		                               name="address" value="<%= (typeof formData !== 'undefined' && formData?.address) || '' %>">
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.address) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.address %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Contact No <span class="text-danger">*</span></label>
		                        <input type="text" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.contact_no) ? 'is-invalid' : '' %>" 
		                               name="contact_no" value="<%= (typeof formData !== 'undefined' && formData?.contact_no) || '' %>" 
		                               placeholder="10-digit mobile number (6-9XXXXXXXX)" required>
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.contact_no) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.contact_no %></div>
		                        <% } %>
		                        <div class="form-text">Format: 10-digit number starting with 6, 7, 8, or 9</div>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Additional Contact No</label>
		                        <input type="text" class="form-control <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.additional_contact_no) ? 'is-invalid' : '' %>" 
		                               name="additional_contact_no" value="<%= (typeof formData !== 'undefined' && formData?.additional_contact_no) || '' %>"
		                               placeholder="Landline, Mobile, or International number">
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.additional_contact_no) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.additional_contact_no %></div>
		                        <% } %>
		                    </div>
		
		                    <div class="col-md-6">
		                        <label class="form-label">Region <span class="text-danger">*</span></label>
		                        <select class="form-select <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.region) ? 'is-invalid' : '' %>" 
		                                name="region" required>
		                            <option value="">Select Region</option>
		                            <option value="Chennai" <%= (typeof formData === 'undefined' || formData?.region === 'Chennai' || !formData?.region) ? 'selected' : '' %>>Chennai</option>
		                            <option value="Chengalpattu" <%= (typeof formData !== 'undefined' && formData?.region === 'Chengalpattu') ? 'selected' : '' %>>Chengalpattu</option>
		                            <option value="Thiruvallur" <%= (typeof formData !== 'undefined' && formData?.region === 'Thiruvallur') ? 'selected' : '' %>>Thiruvallur</option>
		                            <option value="Kancheepuram" <%= (typeof formData !== 'undefined' && formData?.region === 'Kancheepuram') ? 'selected' : '' %>>Kancheepuram</option>
		                            <option value="Vellore" <%= (typeof formData !== 'undefined' && formData?.region === 'Vellore') ? 'selected' : '' %>>Vellore</option>
		                            <option value="Other Districts in TN" <%= (typeof formData !== 'undefined' && formData?.region === 'Other Districts in TN') ? 'selected' : '' %>>Other Districts in TN</option>
		                            <option value="Pondicherry" <%= (typeof formData !== 'undefined' && formData?.region === 'Pondicherry') ? 'selected' : '' %>>Pondicherry</option>
		                            <option value="Andhra Pradesh" <%= (typeof formData !== 'undefined' && formData?.region === 'Andhra Pradesh') ? 'selected' : '' %>>Andhra Pradesh</option>
		                            <option value="Other States in India" <%= (typeof formData !== 'undefined' && formData?.region === 'Other States in India') ? 'selected' : '' %>>Other States in India</option>
		                            <option value="Overseas" <%= (typeof formData !== 'undefined' && formData?.region === 'Overseas') ? 'selected' : '' %>>Overseas</option>
		                            <option value="Others(TN)" <%= (typeof formData !== 'undefined' && formData?.region === 'Others(TN)') ? 'selected' : '' %>>Others(TN)</option>
		                            <option value="Others(IND)" <%= (typeof formData !== 'undefined' && formData?.region === 'Others(IND)') ? 'selected' : '' %>>Others(IND)</option>
		                        </select>
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.region) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.region %></div>
		                        <% } %>
		                    </div>
		                </div>
		            </div>

		            <!-- Astrological Details Section -->
		            <div class="col-12 form-section" data-aos="fade-left" data-aos-delay="800">
		                <h5 class="section-title">
		                    <i class="fas fa-star me-2"></i>Astrological Details
		                </h5>
		                <div class="row g-3">
		                    <div class="col-md-6">
		                        <label class="form-label">Nakshatra ID <span class="text-danger">*</span></label>
		                        <select class="form-select <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.nakshatraid) ? 'is-invalid' : '' %>" 
		                                name="nakshatraid" required>
		                            <option value="">Select Nakshatra</option>
		                            <option value="1" <%= (typeof formData === 'undefined' || formData?.nakshatraid === '1' || formData?.nakshatraid === 1 || !formData?.nakshatraid) ? 'selected' : '' %>>1 - Aswini_Mesham</option>
		                            <option value="2" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '2' || formData?.nakshatraid === 2)) ? 'selected' : '' %>>2 - Barani_Mesham</option>
		                            <option value="3" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '3' || formData?.nakshatraid === 3)) ? 'selected' : '' %>>3 - Karthigai_Mesham</option>
		                            <option value="4" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '4' || formData?.nakshatraid === 4)) ? 'selected' : '' %>>4 - Karthigai_Rishabam</option>
		                            <option value="5" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '5' || formData?.nakshatraid === 5)) ? 'selected' : '' %>>5 - Rohini_Rishabam</option>
		                            <option value="6" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '6' || formData?.nakshatraid === 6)) ? 'selected' : '' %>>6 - Mirugasirisham_Rishabam</option>
		                            <option value="7" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '7' || formData?.nakshatraid === 7)) ? 'selected' : '' %>>7 - Mirugasirisham_Mithunam</option>
		                            <option value="8" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '8' || formData?.nakshatraid === 8)) ? 'selected' : '' %>>8 - Thiruvathirai_Mithunam</option>
		                            <option value="9" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '9' || formData?.nakshatraid === 9)) ? 'selected' : '' %>>9 - Punarpoosam_Mithunam</option>
		                            <option value="10" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '10' || formData?.nakshatraid === 10)) ? 'selected' : '' %>>10 - Punarpoosam_Kadagam</option>
		                            <option value="11" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '11' || formData?.nakshatraid === 11)) ? 'selected' : '' %>>11 - Poosam_Kadagam</option>
		                            <option value="12" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '12' || formData?.nakshatraid === 12)) ? 'selected' : '' %>>12 - Ayilyam_Kadagam</option>
		                            <option value="13" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '13' || formData?.nakshatraid === 13)) ? 'selected' : '' %>>13 - Magam_Simham</option>
		                            <option value="14" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '14' || formData?.nakshatraid === 14)) ? 'selected' : '' %>>14 - Pooram_Simham</option>
		                            <option value="15" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '15' || formData?.nakshatraid === 15)) ? 'selected' : '' %>>15 - Uthiram_Simham</option>
		                            <option value="16" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '16' || formData?.nakshatraid === 16)) ? 'selected' : '' %>>16 - Uthiram_Kanni</option>
		                            <option value="17" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '17' || formData?.nakshatraid === 17)) ? 'selected' : '' %>>17 - Hastham_Kanni</option>
		                            <option value="18" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '18' || formData?.nakshatraid === 18)) ? 'selected' : '' %>>18 - Chithirai_Kanni</option>
		                            <option value="19" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '19' || formData?.nakshatraid === 19)) ? 'selected' : '' %>>19 - Chithirai_Thulam</option>
		                            <option value="20" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '20' || formData?.nakshatraid === 20)) ? 'selected' : '' %>>20 - Swathi_Thulam</option>
		                            <option value="21" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '21' || formData?.nakshatraid === 21)) ? 'selected' : '' %>>21 - Visagam_Thulam</option>
		                            <option value="22" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '22' || formData?.nakshatraid === 22)) ? 'selected' : '' %>>22 - Visagam_Viruchigam</option>
		                            <option value="23" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '23' || formData?.nakshatraid === 23)) ? 'selected' : '' %>>23 - Anusam_Viruchigam</option>
		                            <option value="24" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '24' || formData?.nakshatraid === 24)) ? 'selected' : '' %>>24 - Ketai_Viruchigam</option>
		                            <option value="25" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '25' || formData?.nakshatraid === 25)) ? 'selected' : '' %>>25 - Moolam_Dhanusu</option>
		                            <option value="26" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '26' || formData?.nakshatraid === 26)) ? 'selected' : '' %>>26 - Pooradam_Dhanusu</option>
		                            <option value="27" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '27' || formData?.nakshatraid === 27)) ? 'selected' : '' %>>27 - Uthiradam_Dhanusu</option>
		                            <option value="28" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '28' || formData?.nakshatraid === 28)) ? 'selected' : '' %>>28 - Uthiradam_Magaram</option>
		                            <option value="29" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '29' || formData?.nakshatraid === 29)) ? 'selected' : '' %>>29 - Thiruvonam_Magaram</option>
		                            <option value="30" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '30' || formData?.nakshatraid === 30)) ? 'selected' : '' %>>30 - Avitam_Magaram</option>
		                            <option value="31" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '31' || formData?.nakshatraid === 31)) ? 'selected' : '' %>>31 - Avitam_Kumbham</option>
		                            <option value="32" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '32' || formData?.nakshatraid === 32)) ? 'selected' : '' %>>32 - Sadayam_Kumbham</option>
		                            <option value="33" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '33' || formData?.nakshatraid === 33)) ? 'selected' : '' %>>33 - Pooratathi_Kumbham</option>
		                            <option value="34" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '34' || formData?.nakshatraid === 34)) ? 'selected' : '' %>>34 - Pooratathi_Meenam</option>
		                            <option value="35" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '35' || formData?.nakshatraid === 35)) ? 'selected' : '' %>>35 - Uthiratathi_Meenam</option>
		                            <option value="36" <%= (typeof formData !== 'undefined' && (formData?.nakshatraid === '36' || formData?.nakshatraid === 36)) ? 'selected' : '' %>>36 - Revathi_Meenam</option>
		                        </select>
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.nakshatraid) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.nakshatraid %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Rasi Lagnam <span class="text-danger">*</span></label>
		                        <select class="form-select <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.rasi_lagnam) ? 'is-invalid' : '' %>" 
		                                name="rasi_lagnam" required>
		                            <option value="">Select Rasi Lagnam</option>
		                            <option value="Suth" <%= (typeof formData === 'undefined' || formData?.rasi_lagnam === 'Suth' || !formData?.rasi_lagnam) ? 'selected' : '' %>>Suth</option>
		                            <option value="Sani" <%= (typeof formData !== 'undefined' && formData?.rasi_lagnam === 'Sani') ? 'selected' : '' %>>Sani</option>
		                            <option value="Sevai" <%= (typeof formData !== 'undefined' && formData?.rasi_lagnam === 'Sevai') ? 'selected' : '' %>>Sevai</option>
		                            <option value="Raaghu/Kethu" <%= (typeof formData !== 'undefined' && formData?.rasi_lagnam === 'Raaghu/Kethu') ? 'selected' : '' %>>Raaghu/Kethu</option>
		                            <option value="Sani/Sevai" <%= (typeof formData !== 'undefined' && formData?.rasi_lagnam === 'Sani/Sevai') ? 'selected' : '' %>>Sani/Sevai</option>
		                            <option value="Sani/Kethu/Raaghu" <%= (typeof formData !== 'undefined' && formData?.rasi_lagnam === 'Sani/Kethu/Raaghu') ? 'selected' : '' %>>Sani/Kethu/Raaghu</option>
		                            <option value="Sevai/Kethu/Raaghu" <%= (typeof formData !== 'undefined' && formData?.rasi_lagnam === 'Sevai/Kethu/Raaghu') ? 'selected' : '' %>>Sevai/Kethu/Raaghu</option>
		                            <option value="Sani/Sevai/Kethu/Raaghu" <%= (typeof formData !== 'undefined' && formData?.rasi_lagnam === 'Sani/Sevai/Kethu/Raaghu') ? 'selected' : '' %>>Sani/Sevai/Kethu/Raaghu</option>
		                        </select>
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.rasi_lagnam) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.rasi_lagnam %></div>
		                        <% } %>
		                    </div>
		                </div>
		            </div>

		            <!-- Profile Status Section -->
		            <div class="col-12 form-section" data-aos="fade-right" data-aos-delay="900">
		                <h5 class="section-title">
		                    <i class="fas fa-toggle-on me-2"></i>Profile Status
		                </h5>
		                <div class="row g-3">
		                    <div class="col-md-6">
		                        <label class="form-label">Is Active</label>
		                        <select class="form-select <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.is_active) ? 'is-invalid' : '' %>" 
		                                name="is_active">
		                            <option value="true" <%= (typeof formData === 'undefined' || formData?.is_active === 'true' || formData?.is_active === true || !formData?.is_active) ? 'selected' : '' %>>Yes</option>
		                            <option value="false" <%= (typeof formData !== 'undefined' && (formData?.is_active === 'false' || formData?.is_active === false)) ? 'selected' : '' %>>No</option>
		                        </select>
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.is_active) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.is_active %></div>
		                        <% } %>
		                    </div>
		                    <div class="col-md-6">
		                        <label class="form-label">Is Remarried</label>
		                        <select class="form-select <%= (typeof fieldErrors !== 'undefined' && fieldErrors?.is_remarried) ? 'is-invalid' : '' %>" 
		                                name="is_remarried">
		                            <option value="true" <%= (typeof formData !== 'undefined' && (formData?.is_remarried === 'true' || formData?.is_remarried === true)) ? 'selected' : '' %>>Yes</option>
		                            <option value="false" <%= (typeof formData === 'undefined' || formData?.is_remarried === 'false' || formData?.is_remarried === false || !formData?.is_remarried) ? 'selected' : '' %>>No</option>
		                        </select>
		                        <% if (typeof fieldErrors !== 'undefined' && fieldErrors?.is_remarried) { %>
		                            <div class="invalid-feedback"><%= fieldErrors.is_remarried %></div>
		                        <% } %>
		                    </div>
		                </div>
		            </div>
				<div class="col-12 d-flex justify-content-center gap-3 mt-4">
					<a href="/profile/showall" class="brand-btn-secondary">
						<i class="fas fa-arrow-left me-2"></i>Back
					</a>
					<button type="submit" class="brand-btn">
						<i class="fas fa-save me-2"></i>Create Profile
					</button>
				</div>
			</form>
		    </div>
		</div>

		<!-- Add Gothram Modal -->
		<div class="modal fade" id="addGothramModal" tabindex="-1" aria-labelledby="addGothramModalLabel" aria-hidden="true">
		    <div class="modal-dialog modal-sm">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title" id="addGothramModalLabel">
		                    <i class="fas fa-plus me-2"></i>Add New Gothram
		                </h5>
		                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		            </div>
		            <div class="modal-body">
		                <form id="addGothramForm">
		                    <div class="mb-3">
		                        <label for="newGothramName" class="form-label">Gothram Name <span class="text-danger">*</span></label>
		                        <input type="text" class="form-control" id="newGothramName" name="name" 
		                               placeholder="Enter gothram name" required maxlength="50">
		                        <div class="invalid-feedback" id="gothramErrorMsg"></div>
		                    </div>
		                </form>
		            </div>
		            <div class="modal-footer">
		                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
		                    <i class="fas fa-times me-2"></i>Cancel
		                </button>
		                <button type="button" class="btn brand-btn" id="saveGothramBtn">
		                    <i class="fas fa-save me-2"></i>Save Gothram
		                </button>
		            </div>
		        </div>
		    </div>
		</div>
		
		<%- include('partials/footer') %>
		<script src="/js/vendor/jquery.min.js"></script>
		<script src="/js/vendor/select2.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
		<script src="/js/gothram-dropdown.js"></script>
		<script src="/js/vendor/aos.js"></script>
		<script src="/js/utils/debugLogger.js"></script>
		<script src="/js/serialNumberValidator.js"></script>
		<script>
		    AOS.init({
		        duration: 1000,
		        easing: 'ease-in-out',
		        once: true
		    });
		    
		    // Phase 1: Verify Select2 library is loaded
		    $(document).ready(function() {
		        if (typeof $.fn.select2 !== 'undefined') {
		            window.debugLogger?.info('CreateProfile', '‚úÖ Select2 library loaded successfully');
		        } else {
		            console.error('‚ùå Select2 library failed to load');
		        }
		    });
		    
		    // Enhanced form validation and UX
		    document.addEventListener('DOMContentLoaded', function() {
		        // Initialize Serial Number Validator
		        const serialValidator = new SerialNumberValidator('serial_no', {
		            debounceDelay: 500,
		            showSuccessFeedback: true
		        });
		        window.debugLogger?.info('CreateProfile', '‚úÖ Serial Number Validator initialized');
		        
		        // Auto-scroll to validation summary if errors exist
		        const validationSummary = document.getElementById('validation-summary');
		        if (validationSummary) {
		            validationSummary.scrollIntoView({ 
		                behavior: 'smooth', 
		                block: 'center' 
		            });
		        }
		        
		        // Auto-scroll to first error field
		        const firstErrorField = document.querySelector('.is-invalid');
		        if (firstErrorField && !validationSummary) {
		            firstErrorField.scrollIntoView({ 
		                behavior: 'smooth', 
		                block: 'center' 
		            });
		            firstErrorField.focus();
		        }
		        
		        // Add real-time validation feedback
		        const contactNoField = document.querySelector('input[name="contact_no"]');
		        if (contactNoField) {
		            contactNoField.addEventListener('input', function() {
		                const value = this.value;
		                const isValid = /^[6-9]\d{9}$/.test(value);
		                
		                if (value.length > 0) {
		                    if (isValid) {
		                        this.classList.remove('is-invalid');
		                        this.classList.add('is-valid');
		                    } else {
		                        this.classList.remove('is-valid');
		                        this.classList.add('is-invalid');
		                    }
		                } else {
		                    this.classList.remove('is-valid', 'is-invalid');
		                }
		            });
		        }
		        
		        // Form submission enhancement with validation logging
		        const form = document.querySelector('form');
		        if (form) {
		            form.addEventListener('submit', function(e) {
		                // Log form data for debugging
		                const formData = new FormData(form);
		                const formDataObj = {};
		                const emptyFields = [];
		                const providedFields = [];
		                
		                for (let [key, value] of formData.entries()) {
		                    formDataObj[key] = value;
		                    if (!value || value.trim() === '') {
		                        emptyFields.push(key);
		                    } else {
		                        providedFields.push(key);
		                    }
		                }
		                
		                window.debugLogger?.info('CreateProfile', 'üéØ Form Submission Debug Info', {
		                    timestamp: new Date().toISOString(),
		                    formData: formDataObj,
		                    emptyFields: emptyFields,
		                    providedFields: providedFields,
		                    totalFields: Object.keys(formDataObj).length,
		                    requiredFields: ['name', 'serial_no', 'gender', 'birth_date', 'contact_no', 'nakshatraid'],
		                    missingRequiredFields: ['name', 'serial_no', 'gender', 'birth_date', 'contact_no', 'nakshatraid'].filter(field => 
		                        !formDataObj[field] || formDataObj[field].trim() === ''
		                    )
		                });
		                
		                const submitBtn = form.querySelector('button[type="submit"]');
		                if (submitBtn) {
		                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Creating Profile...';
		                    submitBtn.disabled = true;
		                }
		            });
		        }
		    });
		</script>
		</body>
		</html>
